# Docker Compose Simplificado - WaitTime Service
# Este serviço conecta-se a brokers EXTERNOS (não geridos aqui)

version: '3.8'

services:
  # Wait Time Service (apenas o serviço principal)
  waittime-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: stadium-waittime-service
    environment:
      # Downstream broker (EXTERNO - recebe eventos)
      DOWNSTREAM_BROKER_HOST: rabbitmq  # hostname do broker externo
      DOWNSTREAM_BROKER_PORT: 5672
      DOWNSTREAM_BROKER_USER: guest
      DOWNSTREAM_BROKER_PASSWORD: guest
      DOWNSTREAM_EXCHANGE: stadium.events
      QUEUE_EVENTS_QUEUE: queue_events
      
      # Upstream broker (EXTERNO - publica updates)
      UPSTREAM_BROKER_HOST: rabbitmq  # hostname do broker externo
      UPSTREAM_BROKER_PORT: 5672
      UPSTREAM_BROKER_USER: guest
      UPSTREAM_BROKER_PASSWORD: guest
      UPSTREAM_EXCHANGE: stadium.updates
      
      # Service config
      SERVICE_PORT: 8001
      LOG_LEVEL: INFO
    ports:
      - "8001:8001"
    restart: unless-stopped
    networks:
      - stadium-network

networks:
  stadium-network:
    external: true  # A network deve ser criada externamente e partilhada por todos os serviços

# NOTA:
# - Os brokers RabbitMQ devem ser geridos por outro serviço/docker-compose
# - Este serviço apenas conecta-se aos brokers através da network
# - PostgreSQL foi removido - se persistência for necessária, deve ser gerida por outro serviço
